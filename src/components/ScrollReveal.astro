---
/**
 * ScrollReveal: Wraps content in a container that fades in when scrolled into view.
 * Uses IntersectionObserver for performant scroll-triggered animations.
 */
interface Props {
  class?: string;
  delay?: number;
  direction?: 'up' | 'down' | 'left' | 'right' | 'none';
  threshold?: number;
}

const {
  class: className = '',
  delay = 0,
  direction = 'up',
  threshold = 0.15,
} = Astro.props;

const directionMap: Record<string, string> = {
  up: 'translate-y-8',
  down: '-translate-y-8',
  left: 'translate-x-8',
  right: '-translate-x-8',
  none: '',
};
---

<div
  class={`scroll-reveal opacity-0 ${directionMap[direction]} transition-all duration-700 ease-out ${className}`}
  data-delay={delay}
  data-threshold={threshold}
  style={delay ? `transition-delay: ${delay}ms` : ''}
>
  <slot />
</div>

<script>
  const reveals = document.querySelectorAll('.scroll-reveal');

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const el = entry.target as HTMLElement;
        el.classList.remove('opacity-0', 'translate-y-8', '-translate-y-8', 'translate-x-8', '-translate-x-8');
        el.classList.add('opacity-100', 'translate-y-0', 'translate-x-0');
        observer.unobserve(el);
      }
    });
  }, {
    threshold: 0.15,
    rootMargin: '0px 0px -50px 0px',
  });

  reveals.forEach(el => observer.observe(el));
</script>
